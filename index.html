<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Thông điệp bí mật</title>
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%;font-family:Inter,system-ui,-apple-system,'Segoe UI',Roboto,'Helvetica Neue',Arial;background:#0b1020;color:#e6eef8}
    .center{display:flex;align-items:center;justify-content:center;height:100%}
    .snow{pointer-events:none;position:fixed;inset:0;z-index:0;overflow:hidden}
    .flake{position:absolute;top:-10px;font-size:14px;opacity:.9;user-select:none;filter:blur(.2px)}
    @keyframes fall{to{transform:translateY(110vh) rotate(360deg)}}
    .card{position:relative;z-index:10;background:linear-gradient(180deg,rgba(255,255,255,0.03),rgba(255,255,255,0.01));backdrop-filter:blur(6px);border:1px solid rgba(255,255,255,0.06);padding:28px;border-radius:14px;max-width:760px;width:92%;box-shadow:0 10px 30px rgba(2,6,23,0.6)}
    h1{font-size:1.4rem;margin-bottom:10px;color:#ffeedd}
    p{line-height:1.6;color:#dfe9ff}
    .stats{display:flex;gap:12px;margin-top:12px}
    .stat{background:rgba(255,255,255,0.02);padding:8px 12px;border-radius:8px;font-size:0.9rem}
    .input-row{display:flex;gap:8px;margin-top:14px}
    input[type=text]{flex:1;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit}
    button{padding:10px 14px;border-radius:8px;border:none;background:#4b74ff;color:white;cursor:pointer}
    .letter-area{margin-top:18px;padding:18px;border-radius:10px;background:linear-gradient(180deg,rgba(0,0,0,0.12),rgba(255,255,255,0.02));min-height:140px;position:relative;overflow:hidden}
    .letter-area .line{display:block;font-size:1.05rem;white-space:pre-wrap}
    .letter-area .ch{display:inline-block;transform:translateX(-18px);opacity:0}
    @keyframes slideIn{to{transform:translateX(0);opacity:1}}
    .letter-area::after{content:'';position:absolute;inset:0;background:linear-gradient(180deg,rgba(6,14,32,0.06),transparent);pointer-events:none}
    footer{margin-top:14px;font-size:0.85rem;opacity:0.8}
    @media (max-width:520px){h1{font-size:1.1rem}}
  </style>
</head>
<body>
  <div class="snow" id="snow"></div>

  <div class="center">
    <div class="card" role="main">
      <h1>Đây là thông điệp mình muốn nhắn đến...</h1>
      <p>Vì đây là một thông điệp bí mật mình muốn gửi đến một người. Người mà mình đã từng gặp nhau ở Vũng Tàu vào tháng 8 và mình đã mua 3 bánh bông lan trứng muối ship đến Thủ Đức. Nếu là bạn thì chỉ cần nhập vào là sẽ đọc được lá thư này. Ví dụ mình tên <strong>Nhật</strong> thì hãy ghi là <strong>Nhật</strong>.</p>

      <div class="stats" aria-live="polite">
        <div class="stat" id="stat-hits">🔗 Click link: 0</div>
        <div class="stat" id="stat-ok">✅ Đúng: 0</div>
        <div class="stat" id="stat-wrong">❌ Sai: 0</div>
      </div>

      <div class="input-row" style="margin-top:12px;">
        <input id="name-input" type="text" placeholder="Nhập tên của bạn..." aria-label="Tên" />
        <button id="submit-btn">Mở thư</button>
      </div>

      <div class="letter-area" id="letter-area" aria-live="polite" hidden></div>

      <footer>
        <small>Dữ liệu thống kê lưu realtime trong Firebase Realtime Database.</small>
      </footer>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>

  <script>
    // --- Firebase config ---
    const firebaseConfig = {
      apiKey: "AIzaSyA6I0gSynPjirqXfFU72KjL2-by43NhN10",
      authDomain: "lover-74dcd.firebaseapp.com",
      databaseURL: "https://lover-74dcd-default-rtdb.firebaseio.com",
      projectId: "lover-74dcd",
      storageBucket: "lover-74dcd.firebasestorage.app",
      messagingSenderId: "463130717113",
      appId: "1:463130717113:web:5919db5eac12b38b6ce468",
      measurementId: "G-DVDQGBM1W1"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Tạo node nếu chưa có, không ghi đè
    db.ref('stats').get().then(snapshot => {
      if (!snapshot.exists()) {
        db.ref('stats').set({ hits: 0, ok: 0, wrong: 0 });
      }
    });

    const elHits = document.getElementById('stat-hits');
    const elOk = document.getElementById('stat-ok');
    const elWrong = document.getElementById('stat-wrong');

    // Hiển thị thống kê realtime
    firebase.database().ref('stats').on('value', (snap) => {
      const data = snap.val() || {};
      elHits.textContent = `🔗 Click link: ${data.hits || 0}`;
      elOk.textContent = `✅ Đúng: ${data.ok || 0}`;
      elWrong.textContent = `❌ Sai: ${data.wrong || 0}`;
    });

    // Tăng lượt click mỗi khi ai đó mở link
    firebase.database().ref('stats/hits').transaction(n => (n || 0) + 1);

    const SECRET_NAMES = ['Thư','Thu','thư','thu'];
    const LETTER = `Chào Thư nha. Nếu Thư đọc được dòng code này tức là tui đã đúng. Thư đã đọc nó. Vậy thì hy vọng thư sẽ dành 1 chút thời gian để đọc hết những dòng suy nghĩ của tui nha. Thật ra thì tui cũng không biết nói sao nữa. Nhưng tôi nghĩ mình có tình cảm với Thư hoặc cũng có thể là những suy nghĩ tào lao. Nhưng sau 1 thời gian nhắn tin với Thư thì tui thấy có gì đó khác lạ. Nhất là khi Thư ẩn đi độc thân. và hủy kết bạn insta và locket với tui. Tui sợ từ từ rồi Thư sẽ hủy luôn kết bạn Facebook. Tui biết tui chả là gì với Thư. Một người vừa học giỏi vừa xinh đẹp lại còn là gia sư thì tui làm sao xứng. Một phần nữa chắc Thư thấy tui đăng mấy cái xàm xàm nên hủy ha. Thật ra thì những cái tui đăng đều có ẩn ý tới Thư không à chứ không phải xàm xàm đâu.  Nhưng mà thui không sao. Thư mà đọc tới đây là tui vui rồi. Nếu sau này Thư có cần tui giúp gì hay sao đó cứ kết bạn lại với tui nheeeeee. Tui sẵn lòng giúp cho mà nếu có thèm bánh bông lan thì cũng kêu tui lun, tui mua cho =)).`;

    const input = document.getElementById('name-input');
    const btn = document.getElementById('submit-btn');
    const letterArea = document.getElementById('letter-area');

    function showLetter() {
      letterArea.hidden = false;
      letterArea.innerHTML = '';
      const line = document.createElement('div');
      line.className = 'line';
      Array.from(LETTER).forEach((ch, i) => {
        const sp = document.createElement('span');
        sp.className = 'ch';
        sp.textContent = ch;
        sp.style.animation = `slideIn 600ms cubic-bezier(.2,.8,.2,1) forwards`;
        sp.style.animationDelay = (i * 0.03) + 's';
        line.appendChild(sp);
      });
      letterArea.appendChild(line);
    }

    btn.addEventListener('click', () => {
      const val = input.value.trim();
      if (!val) return;

      if (SECRET_NAMES.includes(val)) {
        firebase.database().ref('stats/ok').transaction(n => (n || 0) + 1);
        showLetter();
      } else {
        firebase.database().ref('stats/wrong').transaction(n => (n || 0) + 1);
        input.animate([{transform:'translateX(0)'},{transform:'translateX(-8px)'},{transform:'translateX(8px)'},{transform:'translateX(0)'}],{duration:420});
      }
    });

    input.addEventListener('keydown', e => { if (e.key === 'Enter') btn.click(); });

    // Hiệu ứng tuyết
    const snow = document.getElementById('snow');
    for (let i = 0; i < 60; i++) {
      const d = document.createElement('div');
      d.className = 'flake';
      d.textContent = '❄';
      const left = Math.random() * 100;
      const size = 8 + Math.random() * 18;
      const delay = Math.random() * -20;
      const dur = 8 + Math.random() * 18;
      d.style.left = left + 'vw';
      d.style.fontSize = size + 'px';
      d.style.opacity = (0.3 + Math.random() * 0.9).toString();
      d.style.animation = `fall ${dur}s linear ${delay}s infinite`;
      d.style.transform = `translateY(-10vh) rotate(${Math.random() * 360}deg)`;
      snow.appendChild(d);
    }
  </script>
</body>
</html>
